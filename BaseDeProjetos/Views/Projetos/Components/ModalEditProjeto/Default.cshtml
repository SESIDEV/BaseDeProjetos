@model BaseDeProjetos.Models.Projeto
@using Microsoft.AspNetCore.Http
@using System.Globalization

@{
    var nivelUsuario = ViewData["NivelUsuario"];
    ViewData["Title"] = "Edit";
    if (!(Context.Session.GetString("_Casa") is null))
    {
        ViewData["Area"] = Context.Session.GetString("_Casa");
    }
}

<form asp-action="Edit" method="post">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <div class="modal fade" id="editarProjetoModal-@Model.Id" aria-hidden="true"
         aria-labelledby="editarProjetoModal-@Model.Id-Label" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="editarProjetoModal-@Model.Id-Label">Dados do Projeto</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label asp-for="Id" class="control-label"></label>
                        <input asp-for="Id" class="form-control" readonly />
                        <span asp-validation-for="Id" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Casa" class="control-label"></label>
                        <select asp-for="Casa" class="form-control"
                                asp-items="Html.GetEnumSelectList<Instituto>()"></select>
                        <span asp-validation-for="Casa" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="Empresa" class="control-label"></label>
                        <select asp-for="Empresa" class="form-control" asp-items='@ViewData["Empresa"] as SelectList'>
                            <option value="@Model.Empresa.Nome" selected disabled>@Model.Empresa.Nome</option>
                        </select>
                        <span asp-validation-for="Empresa" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="NomeProjeto" class="control-label"></label>
                        <input asp-for="NomeProjeto" id="nomeProjeto" class="form-control" />
                        <span asp-validation-for="NomeProjeto" class="text-danger"></span>
                    </div>

                    <div class="mb-2">
                        <label asp-for="MembrosEquipe" class="col-form-label" style="font-weight: 600">Membros</label>
                        <div style="margin-left:3%;display:none" class="spinner-border" role="status" id="loadingOpcoesSelectPessoas-@Model.Id">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <input asp-for="MembrosEquipe" class="form-control d-none" id="inputTextPessoas-@Model.Id" type="text" />
                        <button class="btn app-btn-primary" type="button" style="width: 100%;" id="botaoToggleCaixaRequestPessoas-@Model.Id" onclick="gerarOpcoesSelect('Pessoas','editarProjetoModal','-@Model.Id',true)">Alterar</button>
                        <div class="input-group flex-nowrap" id="caixaPesquisaPessoas-@Model.Id" style="display:none;">
                            <select id="campoSelectPessoas-@Model.Id" class="form-select" multiple="true"></select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label asp-for="AreaPesquisa" class="control-label"></label>
                        <select asp-for="AreaPesquisa" class="form-control"
                                asp-items="Html.GetEnumSelectList<LinhaPesquisa>()"></select>
                        <span asp-validation-for="AreaPesquisa" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Inovacao" class="control-label"></label>
                        <select asp-for="Inovacao" class="form-control"
                                asp-items="Html.GetEnumSelectList<TipoInovacao>()"></select>
                        <span asp-validation-for="Inovacao" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="DataInicio" class="control-label"></label>
                        <input type="date" asp-for="DataInicio" class="form-control" />
                        <span asp-validation-for="DataInicio" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="DataEncerramento" class="control-label"></label>
                        <input type="date" asp-for="DataEncerramento" class="form-control" />
                        <span asp-validation-for="DataEncerramento" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="DuracaoProjetoEmMeses" class="control-label"></label>
                        <input asp-for="DuracaoProjetoEmMeses" min="0" class="form-control" />
                        <span asp-validation-for="DuracaoProjetoEmMeses" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Status" class="control-label"></label>
                        <select asp-for="Status" class="form-control"
                                asp-items="Html.GetEnumSelectList<StatusProjeto>()"></select>
                        <span asp-validation-for="Status" class="text-danger"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn app-btn-primary"
                            data-bs-target="#editarProjetoModal-@Model.Id-Toggle2" data-bs-toggle="modal"
                            onclick="selectToText('campoSelectEdit', 'inputTextEdit')">
                        Próximo
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editarProjetoModal-@Model.Id-Toggle2" aria-hidden="true"
         aria-labelledby="editarProjetoModal-@Model.Id-Label2" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="editarProjetoModal-@Model.Id-Label2">
                        Informações da Empresa
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label asp-for="Estado" class="control-label"></label>
                        <select asp-for="Estado" class="form-control"
                                asp-items="Html.GetEnumSelectList<Estado>()"></select>
                        <span asp-validation-for="Estado" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="FonteFomento" class="control-label"></label>
                        <select asp-for="FonteFomento" class="form-control"
                                asp-items="Html.GetEnumSelectList<TipoContratacao>()">
                            <option selected="selected" value="">Selecione uma opção</option>
                        </select>
                        <span asp-validation-for="FonteFomento" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="ValorTotalProjeto" class="control-label"></label> (R$)
                        <input asp-for="ValorTotalProjeto" class="form-control"
                               placeholder="@Model.ValorTotalProjeto" />
                        <span asp-validation-for="ValorTotalProjeto" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="ValorAporteRecursos" class="control-label"></label> (R$)
                        <input asp-for="ValorAporteRecursos" class="form-control" placeholder="3,00" />
                        <span asp-validation-for="ValorAporteRecursos" class="text-danger"></span>
                    </div>
                    @* Estes campos serão utlizados futuramente, favor não apagar!
                    <fieldset>
                    <legend>Equipe</legend>
                    <div class="form-group">
                    <label class="control-label"> Líder do Projeto</label>
                    <select asp-for="Equipe[0].Id" class="form-control" asp-items="@ViewData["Equipe"] as SelectList">
                    <option value="@(Model.Equipe.Count > 0?Model.Equipe[0].Id : "-1")" selected disabled>
                    @Model.Equipe[0].UserName</option>
                    </select>
                    </div>
                    <div class="form-group">
                    <label class="control-label"> Vice-Líder do Projeto</label>
                    <select asp-for="Equipe[1].Id" class="form-control" asp-items="@ViewData["Equipe"] as SelectList">
                    <option value="@(Model.Equipe.Count > 1?Model.Equipe[1].Id : "-1")" selected disabled>
                    @Model.Equipe[1].UserName</option>
                    </select>
                    </div>
                    </fieldset>
                    *@
                </div>
                <input style="display:none" type="checkbox" disabled class="changeCheck-@Model.Id" value="Pessoas" id="checkPessoas-@Model.Id">
                <div class="modal-footer">
                    <button type="button" class="btn app-btn-primary"
                            data-bs-target="#editarProjetoModal-@Model.Id" data-bs-toggle="modal">
                        Anterior
                    </button>
                    @if (nivelUsuario.ToString() == "Dev" || nivelUsuario.ToString() == "Supervisor" || nivelUsuario.ToString() == "PMO")
                    {
                        <button type="button" class="btn app-btn-primary"
                                data-bs-target="#editarProjetoModal-@Model.Id-Toggle3" data-bs-toggle="modal">
                            Próximo
                        </button>
                    }
                    else
                    {
                        <button type="Submit" class="btn app-btn-primary">
                            Editar
                        </button>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editarProjetoModal-@Model.Id-Toggle3" aria-hidden="true"
         aria-labelledby="editarProjetoModal-@Model.Id-Label3" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="editarProjetoModal-@Model.Id-Label3">
                        Lista de Indicadores por Macroentrega
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    @if (Model.Indicador != null)
                    {
                        <div class="form-group">
                            <label asp-for="NomeProjeto" class="control-label"></label>
                            <input asp-for="NomeProjeto" class="form-control" id="repopularNomeProjeto" readonly />
                            <span asp-validation-for="NomeProjeto" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Indicador.IdProjeto" class="control-label"></label>
                            <input asp-for="Indicador.IdProjeto" class="form-control" readonly />
                            <span asp-validation-for="Indicador.IdProjeto" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Indicador.Id" class="control-label"></label>
                            <input asp-for="Indicador.Id" class="form-control" readonly />
                            <span asp-validation-for="Indicador.Id" class="text-danger"></span>
                        </div>
                        <hr />
                        <h5>Indicadores por Macro-Entrega:</h5>
                    }
                    else
                    {
                        <h3>Não há macroentregas para este projeto. Cadastre ao menos uma!</h3>
                    }

                    @*{
                        int i = 1;
                        foreach (var macroEntrega in @Model.Indicadores)
                        {
                            <div class="accordion" id="accordionIndicadoresProjeto-@macroEntrega.Id">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading@(macroEntrega.Id)">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse@(macroEntrega.Id)" aria-expanded="true" aria-controls="collapse@(macroEntrega.Id)">
                                            Macroentrega @i
                                        </button>
                                    </h2>
                                    <div id="collapse@(macroEntrega.Id)" class="accordion-collapse collapse" data-bs-parent="#accordionIndicadoresProjeto-@macroEntrega.Id">
                                        <div class="accordion-body">
                                            <div class="form-group">
                                                <label class="control-label"> ID da macroentrega</label>
                                                <input asp-for="@macroEntrega.Id" class="form-control" readonly />
                                                <span asp-validation-for="@macroEntrega.Id" class="text-danger"></span>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.Bolsista" class="form-check-input" type="checkbox" id="checkBolsista" />
                                                <label asp-for="@macroEntrega.Bolsista" class="form-check-label"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.ComprasMaterial" class="form-check-input" type="checkbox" id="checkComprasMaterial" />
                                                <label asp-for="@macroEntrega.ComprasMaterial" class="form-check-label" for="checkComprasMaterial"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.ComprasServico" class="form-check-input" type="checkbox" id="checkComprasServico" />
                                                <label asp-for="@macroEntrega.ComprasServico" class="form-check-label"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.PrestacaoContas" class="form-check-input" type="checkbox" id="checkPrestacaoContas" />
                                                <label asp-for="@macroEntrega.PrestacaoContas" class="form-check-label"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.Regramento" class="form-check-input" type="checkbox" id="checkRegramento" />
                                                <label asp-for="@macroEntrega.Regramento" class="form-check-label"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.Relatorios" class="form-check-input" type="checkbox" id="checkRelatorios" />
                                                <label asp-for="@macroEntrega.Relatorios" class="form-check-label" for="checkRelatorios"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.Repasse" class="form-check-input" type="checkbox" id="checkRepasse" />
                                                <label asp-for="@macroEntrega.Repasse" class="form-check-label" for="checkRepasse"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.SatisfacaoMetadeProjeto" class="form-check-input" type="checkbox" id="checkSatisfacaoMetadeProjeto" />
                                                <label asp-for="@macroEntrega.SatisfacaoMetadeProjeto" class="form-check-label" for="checkSatisfacaoMetadeProjeto"></label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@macroEntrega.SatisfacaoFimProjeto" class="form-check-input" type="checkbox" id="checkSatisfacaoFimProjeto" />
                                                <label asp-for="@macroEntrega.SatisfacaoFimProjeto" class="form-check-label" for="checkSatisfacaoFimProjeto"></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            i++;
                        }
                    }*@
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn app-btn-primary"
                            data-bs-target="#editarProjetoModal-@Model.Id-Toggle2" data-bs-toggle="modal">
                        Anterior
                    </button>
                    <button type="Submit" class="btn app-btn-primary">
                        Editar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}